app.controller("accountCtl",["$scope","$http","$location","AppStore",function(e,t,a,n){"use strict";function s(){e.account.name=n.getUserName(),e.account.number=n.getUserNumber(),e.account.email=n.getUserEmail(),e.account.campus=n.getCampusName()}function r(){t.get("api.php/v1/account/ads",{headers:{token:n.getToken()}}).then(function(t){e.ads=t.data},function(e){})}function o(){n.isToken()?(s(),r(),e.accountState=i.MAIN):(t.get("api.php/v1/campuses",{cache:!0}).then(function(t){i.insties=t.data,e.instList=i.insties}),e.accountState=i.LOGIN)}function c(t){return"undefined"==typeof t||t.length<10?(e.errMsg="Cellphone diits must be 10 characters long",!1):!0}function u(t){return"undefined"==typeof t||t.length<4?(e.errMsg="Name must have at least 4 characters",!1):t.search(/[a-z]/i)<0?(e.errMsg="Your name must contain at least one letter.",!1):!0}function l(e){var t=/\S+@\S+\.\S+/;return t.test(e)}function f(t){return"undefined"==typeof t||t.length<4?(e.errMsg="Password must have at least 4 characters",!1):t.search(/[a-z]/i)<0?(e.errMsg="Your password must contain at least one letter.",!1):t.search(/[0-9]/)<0?(e.errMsg="Your password must contain at least one digit.",!1):t.equals===e.formData.rePwd?(e.errMsg="Passwords do not match",!1):!0}function d(t){if(!l(t.email))return e.error(0),!1;if(!f(t.password))return e.error(2),!1;if(!u(t.dName))return e.error(1),!1;if(c(t.number)){if("undefined"!=typeof e.formData.campusId)return e.error(-1),!0;e.error(3),e.errMsg="Campus isn't selected"}else e.error(2)}function p(){t.get("api.php/v1/account",{headers:{token:n.getToken()}}).then(function(e){n.setCampus(e.data.campus.id,e.data.campus.name),n.setUserId(e.data.id),n.setUserName(e.data.name),n.setUserEmail(e.data.email),n.setUserNumber(e.data.number),s()},function(e){})}function m(a,s){var o={email:a.toLowerCase(),password:s};t.post("api.php/v1/users/auth",$.param(o)).then(function(t){n.setToken(t.data.token),n.setUserId(t.data.id),e.accountState=i.MAIN,p(),r()},function(e){})}var i=this;i.LOADING=0,i.LOGIN=1,i.REGISTER=2,i.RECOVERY=3,i.MAIN=4,i.CONSOLE=5,i.MESSAGES=6,i.PREFERENCES=7,i.FAQS=8,i.insties=[],e.error=function(t){switch(t){case 0:e.err=!0,e.errMsg="Error in email format i.e. '@'";break;case 1:e.err=!0;break;case 2:e.err=!0;break;case 3:e.err=!0;break;default:e.err=!1}},e.formData={},e.authData={},e.account={},e.cState=0,e.lTitle="- Select your campus -",e.sTitle="",e.openChooser=function(){e.isCOpen=!0},e.browse=function(t){0===e.cState?(e.sTitle=i.insties[t].name,e.instList=i.insties[t].campuses,e.cState=1):(e.formData.campusId=e.instList[t].id,e.isCOpen=!1,e.lTitle=e.instList[t].name)},e.changeC=function(){e.instList=i.insties,e.cState=0},e.toRecovery=function(){e.accountState=i.RECOVERY,e.err=!1},e.toRegister=function(){e.accountState=i.REGISTER,e.err=!1},e.toLogin=function(){e.accountState=i.LOGIN,e.err=!1},e.toLogin=function(){e.accountState=i.LOGIN,e.err=!1},e.recover=function(){"undefined"==typeof e.recoveryMail?e.err=!0:(e.err=!1,t.post().then(function(e){}))},e.logIn=function(){"undefined"==typeof e.authData.email?(e.err=!0,e.errMsg="Email field is empty!"):"undefined"==typeof e.authData.password?(e.err=!0,e.errMsg="Password field is empty!"):(e.err=!1,m(e.authData.email,e.authData.password))},e.onEdit=function(){},e.delAcc=function(){a.url("/account/delete")},e.faqs=function(){a.url("/faqs/account")},e.logout=function(){n.clearAll(),a.url("/home")},e.createAd=function(){a.url("/ads/create")},e.createNew=function(){if(d(e.formData)){e.formData.email=e.formData.email.toLowerCase();var a=JSON.parse(JSON.stringify(e.formData));delete a.rePwd,t.post("/api.php/v1/users/new",$.param(a)).then(function(e){m(a.email,a.password)},function(e){})}},e.openAd=function(e){a.url("/ads/"+e)},o()}]),app.controller("homeCtl",["$scope","$http","$location","AppStore",function(e,t,a,n){"use strict";function i(){t.get("api.php/v1/ads?cid="+n.getCampusId()).then(function(t){e.ads=t.data},function(e){})}e.title="Some demo text and more testimonial bitch",e.campus=n.getCampusName(),e.viewAd=function(e){a.url("/ads/"+e)},i()}]),app.controller("adsCreateCtl",["$scope","$location","$http","AppStore",function(e,t,a,n){"use strict";e.cat=!1,e.display="- Choose category - ",e.cats=[{id:1,name:"Books & Study Material"},{id:2,name:"Electronics & Gadgets"},{id:3,name:"Phones & Laptops"},{id:4,name:"Services & Other"}],e.dummy=[1,2,3,4,5],e.images=[],e.ad={price:0,images:[]};var i=new FileReader;i.onload=function(){e.images.push(i.result),e.dummy.splice(-1),e.$apply()},e.clear=function(t){6!==e.images.length&&e.dummy.push(e.dummy.length+1),e.images.splice(t,1)},e.cancelAd=function(){t.url("/account")},e.show=function(){e.cat=!0},e.sel=function(t){e.ad.category=e.cats[t].id,e.display=e.cats[t].name,e.cat=!1},e.back=function(){e.aPage-=1,2===e.aPage&&e.dummy.splice(-1)},e.step=function(){1===e.aPage?e.aPage+=1:2===e.aPage?(e.aPage+=1,e.dummy.push(e.dummy.length+1)):3===e.aPage&&(e.ad.userId=n.getUserId(),e.ad.images=[],e.images.forEach(function(t){e.ad.images.push(t.substring(t.indexOf(",")+1))}),a.post("api.php/v1/ads",$.param(e.ad),{headers:{token:n.getToken()}}).then(function(e){t.url("/account")},function(e){}))},e.fileNameChanged=function(e){i.readAsDataURL(e[0])}}]),app.controller("adsCtl",["$scope","$timeout","$location","$http","$routeParams","AppStore",function(e,t,a,n,i,s){"use strict";function o(){"undefined"!=typeof i.id&&n.get("api.php/v1/ads?id="+i.id,{cache:!0}).then(function(t){e.ad=t.data,r=new Array(e.ad.src_id.length),e.ad.src_id.forEach(function(t){r[e.ad.src_id.indexOf(t)]=t}),e.cover=e.ad.src_id.splice(0,1),e.dummy=new Array(5-e.ad.src_id.length);var a=0;for(a=0;a<e.dummy.length;a+=1)e.dummy[a]=a;s.isToken()&&(e.state=1,e.email=s.getUserEmail(),s.getUserId()-e.ad.uid===0&&(e.state=2))},function(e){})}var r;e.isGuest=!0,e.sendMessage=function(){},e.userClicked=function(){a.url("/ads/search?u="+e.ad.uid+"&name="+e.ad.name)},e.reportAd=function(e){},e.inView={id:0,next:!0,prev:!0},e.view=function(t){e.inView.id=t,0===r.indexOf(t)?e.inView.prev=!1:e.inView.prev=!0,r.indexOf(t)===r.length-1?e.inView.next=!1:e.inView.next=!0,e.isViewing=!0},e.next=function(){e.inView.next===!0&&e.view(r[r.indexOf(e.inView.id)+1])},e.prev=function(){e.inView.prev===!0&&e.view(r[r.indexOf(e.inView.id)-1])},o()}]),app.controller("adsSearchCtl",["$scope","$routeParams","$location","$http","AppStore",function(e,t,a,n,i){"use strict";function f(t){n.get("api.php/v1/ads?"+t).then(function(t){e.ads=t.data,e.sLabel=o[1].label.toLowerCase(),o[1].id>2&&(e.sLabel="price listed")},function(e){})}function d(){if(0===e.ad.length)return!1;var t=!1,a=[];return e.ad.forEach(function(n){var i=n.title.toLowerCase(),s=e.query.toLowerCase(),r=i.match(s);null===r?a.push(e.ad.indexOf(n)):t=!0}),a.forEach(function(t){e.ad.splice(t,1)}),t}function p(){n.get("api.php/v1/ads?cid="+i.getCampusId()+"&q="+e.query+"&a=n").then(function(t){e.ad=t.data},function(e){}),n.get("api.php/v1/users?cid="+i.getCampusId()+"&q="+e.query).then(function(t){e.user=t.data},function(e){})}var o,s=[],r=0,u={};n.get("api.php/v1/campuses",{cache:!0}).then(function(t){s=t.data;e.list=[],s.forEach(function(t){e.list.push(t)})},function(e){}),e.browse=function(t){0===r?(e.mSub+=" > "+s[t].name,e.list=[],s[t].campuses.forEach(function(t){e.list.push(t)}),r=1):(i.clearAll(),i.setCampus(e.list[t].id,e.list[t].name),e.cName=e.list[t].name,e.mState=0,e.mSub="",e.list=s,r=0,e.query="",e.sSection=0,e.opt=!1,a.url("/ads/search"))},e.cName=i.getCampusName(),e.query="",e.sSection=0,e.ad=[],e.back=function(){e.search?a.url("/ads/search"):a.url("/home")},e.menuBack=function(){e.mState>0?(e.mState=0,e.mSub="",e.list=[],s.forEach(function(t){e.list.push(t)}),r=0):(e.opt=!1,2!==e.sSection&&e.query.length>0?a.url("/ads/search?q="+e.query):a.url("/ads/search"))},e.viewUser=function(e,t){a.url("/ads/search?u="+e+"&name="+t)},e.viewAd=function(e){a.url("/ads/"+e)},e.suggest=function(){e.isTyping||(e.isTyping=!0),e.query.length>1&&(d()||p())},e.searchFor=function(){e.query.length>1&&a.url("/ads/search/?q="+e.query)},e.changeCampus=function(){e.mState=1,e.mSub="Campus"},e.cats=[{id:0,label:"All categories"},{id:1,label:"Books & Study Materials"},{id:2,label:"Electronics & Gadgets"},{id:3,label:"Phones & Laptops"},{id:4,label:"Services & Other"}],e.changeCategory=function(t){"undefined"==typeof t?(e.mState=2,e.mSub="Category"):(o[0]=e.cats[t],i.setSearchPrefs(o),e.catLabel=e.cats[t].label,e.mState=0,e.mSub="")},e.sorts=[{id:1,label:"Latest"},{id:2,label:"Top viewed"},{id:3,label:"Price (lowest to highest)"},{id:4,label:"Price (highest to lowest)"}],e.changeSorting=function(t){"undefined"==typeof t?(e.mState=3,e.mSub="Sort By"):(o[1]=e.sorts[t],i.setSearchPrefs(o),e.sortLabel=e.sorts[t].label,e.mState=0,e.mSub="")},o=i.getSearchPrefs(),o===!1?(e.catLabel=e.cats[0].label,e.sortLabel=e.sorts[0].label,o=[e.cats[0],e.sorts[0]],i.setSearchPrefs(o)):(e.catLabel=o[0].label,e.sortLabel=o[1].label),"undefined"!=typeof t.q?(e.query=t.q,e.sSection=1,0!==o[0].id&&(u.c=o[0].id),u.cid=i.getCampusId(),u.s=o[1].id,log(e.sLabel),u.q=t.q,f($.param(u))):"undefined"!=typeof t.u&&"undefined"!=typeof t.name&&(e.sSection=2,e.query=t.name,u.uid=t.u,f($.param(u)))}]),app.controller("faqsCtl",["$scope","$routeParams",function(e,t){"use strict";log(t)}]),app.controller("delAccCtl",["$scope","$location",function(e,t){"use strict";e.cancel=function(){t.url("/account")},e.conf=function(){}}]),app.controller("landingCtl",["$scope","$http","AppStore","$location",function(e,t,a,n){"use strict";var i=[];t.get("api.php/v1/campuses",{cache:!0}).then(function(t){i=t.data;e.list=[],i.forEach(function(t){e.list.push(t)})},function(e){}),e.state=0,e.browse=function(t){0===e.state?(e.iName=i[t].name,e.list=[],i[t].campuses.forEach(function(t){e.list.push(t)}),e.state=1):(a.setCampus(e.list[t].id,e.list[t].name),n.url("/home"))},e.change=function(){e.state=0,e.list=[],i.forEach(function(t){e.list.push(t)})},e.getStarted=function(){a.isNew()?e.dialog=!0:n.url("/home")}}]),app.controller("notFoundCtl",[function(){"use strict"}]);
